<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFRPè¨˜äº‹ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/common.css" rel="stylesheet">
    <link href="assets/css/articles.css" rel="stylesheet">
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">CFRP Monitor <small class="text-white-50 version-text">v2025.01.08.12</small></a>
            <div class="navbar-nav">
                <a class="nav-link active" href="index.html">ğŸ“° è¨˜äº‹ç®¡ç†</a>
                <a class="nav-link" id="sourcesLink" href="sources.html">ğŸ“¡ æƒ…å ±æºç®¡ç†</a>
                <a class="nav-link" id="userManagementLink" href="users.html" style="display: none;">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</a>
            </div>
            <div class="navbar-nav">
                <span class="navbar-text me-3" id="userInfo">
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </span>
                <button class="btn btn-outline-light btn-sm" id="logoutBtn" style="display: none;">
                    ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <header class="mb-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <h1 class="h2 me-4">CFRPè¨˜äº‹ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                <div class="d-flex g-3 align-items-center flex-wrap gap-1">
                    <div class="d-flex align-items-center">
                        <label for="statusFilter" class="form-label me-2 mb-0 nowrap">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
                        <select id="statusFilter" class="form-select form-select-sm">
                            <option value="">å…¨ã¦</option>
                            <option value="unread">æœªèª­</option>
                            <option value="reviewed">ç¢ºèªæ¸ˆã¿</option>
                            <option value="flagged">ãƒ•ãƒ©ã‚°ä»˜ã</option>
                            <option value="archived">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label for="flaggedFilter" class="form-label me-2 mb-0 nowrap">é‡è¦:</label>
                        <select id="flaggedFilter" class="form-select form-select-sm">
                            <option value="">å…¨ã¦</option>
                            <option value="true">é‡è¦ã®ã¿</option>
                            <option value="false">é€šå¸¸ã®ã¿</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label for="sourceFilter" class="form-label me-2 mb-0 nowrap">ã‚½ãƒ¼ã‚¹:</label>
                        <select id="sourceFilter" class="form-select form-select-sm">
                            <option value="">å…¨ã¦</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label for="sortOrder" class="form-label me-2 mb-0 nowrap">ä¸¦ã³é †:</label>
                        <select id="sortOrder" class="form-select form-select-sm">
                            <option value="desc">æ–°ã—ã„é †</option>
                            <option value="asc">å¤ã„é †</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label for="itemsPerPage" class="form-label me-2 mb-0 nowrap">è¡¨ç¤ºä»¶æ•°:</label>
                        <select id="itemsPerPage" class="form-select form-select-sm">
                            <option value="10">10ä»¶</option>
                            <option value="20" selected>20ä»¶</option>
                            <option value="50">50ä»¶</option>
                            <option value="100">100ä»¶</option>
                        </select>
                    </div>
                    <button id="refreshBtn" class="btn btn-primary btn-sm">æ›´æ–°</button>
                </div>
            </div>
        </header>

        <div id="loading" class="loading">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
            <p>è¨˜äº‹ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        </div>

        <!-- ä¸Šéƒ¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav id="paginationTop" aria-label="è¨˜äº‹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸Šéƒ¨ï¼‰" style="display: none;">
            <div class="d-flex justify-content-end align-items-center mb-3">
                <ul class="pagination pagination-sm mb-0" id="paginationListTop">
                </ul>
            </div>
        </nav>

        <div id="articlesContainer" style="display: none;"></div>
        
        <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="editModeContainer" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>è¨˜äº‹ç·¨é›†</h3>
                <button class="btn btn-outline-secondary btn-sm btn-close-edit">ä¸€è¦§ã«æˆ»ã‚‹</button>
            </div>
            <div id="editCard"></div>
        </div>
        
        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav id="pagination" aria-label="è¨˜äº‹ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mt-4">
                <div id="pageInfo" class="text-muted"></div>
                <ul class="pagination pagination-sm mb-0" id="paginationList">
                </ul>
            </div>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // APIãƒ™ãƒ¼ã‚¹ã®èªè¨¼ãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', function() {
            const authToken = localStorage.getItem('auth_token');
            const userInfo = localStorage.getItem('user_info');
            
            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            if (!authToken) {
                window.location.href = '/login';
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
            if (userInfo) {
                try {
                    const user = JSON.parse(userInfo);
                    document.getElementById('userInfo').innerHTML = `
                        <i class="bi bi-person-circle"></i> ${user.display_name || user.user_id} 
                        <span class="badge bg-secondary">${user.role}</span>
                    `;
                    
                    // ç®¡ç†è€…ã®ã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
                    if (user.role === 'admin') {
                        document.getElementById('userManagementLink').style.display = 'block';
                    }
                    
                    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                    document.getElementById('logoutBtn').style.display = 'block';
                } catch (e) {
                    console.error('Failed to parse user info:', e);
                    localStorage.removeItem('user_info');
                    window.location.href = '/login';
                }
            }
            
            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('user_info');
                    window.location.href = '/login';
                }
            });
        });
    </script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/security.js"></script>
    <script src="assets/js/articles.js"></script>
</body>
</html>